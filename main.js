(()=>{"use strict";function t(t,e,n){if(t.querySelector(".modal"))return;t.insertAdjacentHTML("beforeEnd",'\n      <div data-widget="removeTicket" class="modal widget-remove">\n        <h2>Удалить тикет?</h2>  \n        <div class="widget-form">\n          <p class="widget-remove-text">Вы уверены, что хотите удалить тикет? Это действие необратимо.</p>\n          <div class="widget-form-controls">\n            <button data-id="cancel" class="widget-button">Отмена</button>  \n            <button data-id="ok" class="widget-button">Ок</button> \n          </div> \n        </div>\n      </div>\n      '),function(t){if(!t)return;const e=t.querySelector("[data-widget=removeTicket]");e.querySelector("[data-id=cancel]").addEventListener("click",(()=>{e.remove()}))}(t),function(t,e,n){if(!t)return;const d=t.querySelector("[data-widget=removeTicket]");d.querySelector("[data-id=ok]").addEventListener("click",(()=>{const t={id:e.dataset.id},a=e.dataset.id,s=`${n}/?method=deleteById&id=${a}`,i=new XMLHttpRequest;i.open("POST",s),i.setRequestHeader("Content-Type","application/json"),document.body.style.cursor="wait",i.addEventListener("load",(()=>{if(i.status>=200&&i.status<300)try{setTimeout((()=>{document.body.style.cursor="",document.location.reload()}),1e3)}catch(t){console.error(t)}})),d.remove(),i.send(JSON.stringify(t))}))}(t,e,n)}function e(t,e){if(t.querySelector(".modal"))return;t.insertAdjacentHTML("beforeEnd",'\n      <div data-widget="addTicket" class="modal widget-add">\n      <h2>Добавить тикет</h2>  \n      <form data-id="addTicket-form" class="widget-form">\n        <label>\n          Краткое описание\n            <textarea rows=1 data-id="name" name="name" required class="widget-input"></textarea>\n        </label>\n        <label>\n          Подробное описание\n            <textarea rows=3 data-id="description" name="description" class="widget-input"></textarea>\n        </label>\n        <div class="widget-form-controls">\n          <button data-id="cancel" class="widget-button">Отмена</button>  \n          <button type="submit" data-id="ok" class="widget-button">Ок</button> \n        </div>     \n      </form>\n      </div>\n      '),function(t){if(!t)return;const e=t.querySelector("[data-widget=addTicket]"),n=e.querySelector("[data-id=addTicket-form]");e.querySelector("[data-id=cancel]").addEventListener("click",(()=>{n.reset(),e.remove()}))}(t),function(t,e){if(!t)return;const n=t.querySelector("[data-widget=addTicket]"),d=n.querySelector("[data-id=addTicket-form]");d.addEventListener("submit",(t=>{t.preventDefault();const a=d.name.value.trim(),s=d.description.value.trim();if(""===a)return;const i={name:a,description:s,status:!1,created:(new Date).toLocaleString()},o=`${e}?method=createTicket`,r=new XMLHttpRequest;r.open("POST",o),r.setRequestHeader("Content-Type","application/json"),document.body.style.cursor="wait",n.style.cursor="wait",r.addEventListener("load",(()=>{if(r.status>=200&&r.status<300)try{setTimeout((()=>{document.body.style.cursor="",n.style.cursor="",document.location.reload()}),1e3)}catch(t){console.error(t)}})),r.send(JSON.stringify(i)),d.reset(),n.remove()}))}(t,e)}function n(t,e,n,d){if(t.querySelector(".modal"))return;t.insertAdjacentHTML("beforeEnd",'\n      <div data-widget="editTicket" class="modal widget-edit">\n      <h2>Редактировать тикет</h2>  \n      <form data-id="editTicket-form" class="widget-form">\n        <label>\n          Краткое описание\n            <textarea rows=1 data-id="name" name="name" required class="widget-input"></textarea>\n        </label>\n        <label>\n          Подробное описание\n            <textarea rows=3 data-id="description" name="description" class="widget-input"></textarea>\n        </label>\n        <div class="widget-form-controls">\n          <button data-id="cancel" class="widget-button">Отмена</button>  \n          <button type="submit" data-id="ok" class="widget-button">Ок</button> \n        </div>     \n      </form>\n      </div>\n      '),function(t,e,n){if(!t)return;const d=t.querySelector("[data-widget=editTicket]").querySelector("[data-id=description]"),a=`${n}/?method=ticketById&id=${e.dataset.id}`,s=new XMLHttpRequest;s.open("GET",a),s.addEventListener("load",(()=>{if(s.status>=200&&s.status<300)try{const t=JSON.parse(s.response).description;d.value=t}catch(t){console.error(t)}})),s.send()}(t,e,d),function(t){if(!t)return;const e=t.querySelector("[data-widget=editTicket]"),n=e.querySelector("[data-id=editTicket-form]");e.querySelector("[data-id=cancel]").addEventListener("click",(()=>{n.reset(),e.remove()}))}(t),function(t,e,n){if(!t)return;const d=t.querySelector("[data-widget=editTicket]"),a=d.querySelector("[data-id=editTicket-form]"),s=d.querySelector("[data-id=name]"),i=e.closest(".ticket-wrapper").dataset.id,o=e.closest(".ticket-wrapper").querySelector(".ticket-name").textContent,r=e.closest(".ticket-wrapper").querySelector(".ticket-status").dataset.status;s.value=o,a.addEventListener("submit",(t=>{t.preventDefault();const e=a.name.value.trim(),s=a.description.value.trim();if(""===e)return;const o={id:i,name:e,description:s,status:r,created:(new Date).toLocaleString()},c=`${n}/?method=updateById&id=${i}`,u=new XMLHttpRequest;u.open("POST",c),u.setRequestHeader("Content-Type","application/json"),document.body.style.cursor="wait",d.style.cursor="wait",u.addEventListener("load",(()=>{if(u.status>=200&&u.status<300)try{setTimeout((()=>{document.body.style.cursor="",d.style.cursor="",document.location.reload()}),1e3)}catch(t){console.error(t)}})),a.reset(),d.remove(),u.send(JSON.stringify(o))}))}(t,n,d)}const d="https://http-back.onrender.com",a=document.querySelector(".container"),s=document.querySelector(".tickets-container"),i=document.querySelector(".add-ticket-button");document.addEventListener("DOMContentLoaded",(()=>{const o=new XMLHttpRequest;o.open("GET",`${d}?method=allTickets`),o.responseType="json",o.addEventListener("load",(()=>{if(o.status>=200&&o.status<300)try{const e=o.response;if(!e.length)return;e.forEach((e=>{!function(t,e){const n=new Date(t.created),d=`${n.toLocaleDateString()} ${n.toLocaleTimeString()}`,a=`\n  <div data-id="${t.id}" class="ticket-wrapper">\n    <div class="ticket-body">\n      <div data-status="${t.status}" class="ticket-status">\n      <span class="ticket-status-checkbox hidden">&#10004;</span>\n      </div>\n      <div class="ticket-name"><p>${t.name}</p></div>\n      <div class="ticket-timestamp">\n        <span>${d}</span>\n      </div>\n      <div class="ticket-edit-button">\n      <span>&#9998;</span>\n      </div>\n      <div class="ticket-remove-button">\n        <span>&#10006;</span>\n      </div>\n    </div>\n    <div class="ticket-description hidden"><p></p></div>\n  </div>\n   `;e.insertAdjacentHTML("beforeEnd",a)}(e,s);const i=s.lastElementChild,o=i.querySelector(".ticket-status"),r=o.querySelector(".ticket-status-checkbox");"true"===o.dataset.status&&r.classList.remove("hidden");const c=i.querySelector(".ticket-name"),u=i.querySelector(".ticket-edit-button"),l=i.querySelector(".ticket-remove-button");o.addEventListener("click",(()=>{!function(t,e,n,d,a){if(t.querySelector(".modal"))return;d.classList.toggle("hidden");let{status:s}=n.dataset;const i=d.classList.contains("hidden");i&&(s=!1),i||(s=!0);const o={id:e.dataset.id,status:s},r=new XMLHttpRequest;r.open("POST",`${a}/?method=updateById&id=${e.dataset.id}`),r.setRequestHeader("Content-Type","application/json"),document.body.style.cursor="wait",r.addEventListener("load",(()=>{if(r.status>=200&&r.status<300)try{setTimeout((()=>{document.body.style.cursor=""}),500)}catch(t){console.error(t)}})),r.send(JSON.stringify(o))}(a,i,o,r,d)})),c.addEventListener("click",(()=>{!function(t,e,n,d){if(t.querySelector(".modal"))return;const a=n.closest(".ticket-wrapper").querySelector(".ticket-description");if(!a.classList.contains("hidden"))return void a.classList.add("hidden");const s=`${d}/?method=ticketById&id=${e.dataset.id}`,i=new XMLHttpRequest;i.open("GET",s),document.body.style.cursor="wait",i.addEventListener("load",(()=>{if(i.status>=200&&i.status<300)try{const t=i.response;if(setTimeout((()=>{document.body.style.cursor=""}),1e3),!t)return;a.textContent=JSON.parse(t).description,a.classList.toggle("hidden")}catch(t){console.error(t)}})),i.send()}(a,i,c,d)})),u.addEventListener("click",(()=>{n(a,i,u,d)})),l.addEventListener("click",(()=>{t(a,i,d)}))}))}catch(t){console.error(t)}})),o.send(),i.addEventListener("click",(()=>{e(a,d)}))}))})();